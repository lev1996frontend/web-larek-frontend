https://github.com/lev1996frontend/web-larek-frontend.git

# Проектная работа "Веб-ларек"

## Оглавление

- [Запуск](#запуск)
- [Сборка](#сборка)
- [Документация](#документация)

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Подход разработки

`User is working on a project that uses an event-driven approach combined with the MVP (Model-View-Presenter) design pattern.`

В этом проекте применяется событийно-ориентированный подход, при котором взаимодействие между компонентами приложения осуществляется через обмен сообщениями, вызванными определенными событиями.

Проект также реализован с использованием модели MVP (Model-View-Presenter), которая делит приложение на три ключевых компонента: модель, представление и презентатор. Модель отвечает за управление данными и бизнес-логикой, представление служит интерфейсом пользователя, а презентатор осуществляет связь между моделью и представлением, обрабатывая события и передавая данные между ними.

## Документация

#### Класс `Model<T>`

Абстрактный класс дженерик.

**Конструктор:**

- принимает на вход объект данных неявного типа и объект события типа `IEvent`.

#### Класс `Component<T>`

Абстрактный класс дженерик.

**Конструктор:**

- принимает на вход `container` типа `HTMLElement`

**Методы:**

- `setDisabled` — блокирует кнопку
- `setText` — устанавливает текст элемента
- `setImage` — задаёт изображение элемента и его атрибут alt
- `render` — объединяет данные и выполняет отрисовку.

#### Класс `EventEmitter`

Класс EventEmitter обеспечивает работу событий.

#### Класс `Api`

Получает и содержит базовый url (baseUrl) и опции запроса (options).

### Компоненты модели данных (Model)

#### Класс `WebLarekApi`

Предназначен для использования в клиентском приложении, чтобы упростить взаимодействие с сервером, не беспокоясь о том, как именно устроены HTTP-запросы. Расширяется базовым классом `Api`.

**Конструктор**

- принимает передает в родительский конструктор `Api` поля `baseUrl` и `options`
- принимает и сохраняет входящий `url` запроса в `contentDeliveryNetwork`.

**Поля**

- `contentDeliveryNetwork` — принимает входящий `url`

**Методы**

- `getProductList` — Этот метод выполняет GET-запрос по маршруту /product. Ожидается, что ответ будет содержать список продуктов, и метод возвращает массив этих продуктов, преобразовывая каждый элемент. `ApiListResponse<IProductItem>` предполагает, что это тип ответа с полем items, содержащим массив продуктов
- `orderProducts` — Этот метод выполняет POST-запрос на /order, передавая данные заказа. Он ожидает, что сервер вернёт результат заказа, который возвращается в виде Promise.

#### Класс `AppState`

Этот класс представляет собой модель данных всего приложения. Он включает основные группы данных страницы и методы для их обработки.

Здесь распределяются данные различных частей приложения: каталог, превью, корзина и форма заказа.

Класс расширяет базовый абстрактный класс `Model<T>` и реализует интерфейс `IAppState`.

```tsx
export interface IAppState {
	catalog: IProductItem;
	preview: string | null;
	basket: string[];
	total: number | string;
	loading: boolean;
	order: IOrder | null;
}
```

**Поля**

- `catalog` — Состояние каталога с продуктами (полагается, что IProductItem - интерфейс для отдельного продукта)
- `preview` — Предпросмотр, который может быть строкой или null (например, если нет активного продукта для предпросмотра)
- `basket` — Корзина, представляющая собой массив строк (может содержать идентификаторы продуктов или названия)
- `order` — Заказ, который может быть объектом типа IOrder или null (если ещё нет активного заказа)
- `loading` — Индикатор загрузки, логическое значение, показывающее, загружаются ли данные в данный момент
- `formErrors` — ошибки, возникшие при валидации.

**Методы**

`clearBasket` — очищает корзину.
`addItemToOrder` — добавляет товар в заказ, обновляет общую стоимость в заказе.
`removeFromOrder` — удаляет товар из заказа.
`setCatalog` — устанавливает данные в каталог.
`setPreview` — устанавливает данные в превью.
`setProductToBasket` — добавляет товар в корзину.
`removieFromBasket` — удаляет товар из корзины, обновляет общую стоимость в заказе.
`get statusBasket` — возвращает статус корзины.
`get basket` — возвращает данные товаров в корзине.
`updateTotal` — обновляет общую сумму товаров в корзине.
`getTotal` — возвращает общую сумму товаров в корзине.
`setOrderField` — устанавливает значение поля заказа.
`setContactsField` — устанавливает значение поля контактов.
`validateOrder` — проводит валидацию данных заказа.
`validateContact` — проводит валидацию данных контактов.

#### Класс `ProductItem`

Является моделью хранения данных товара: идентификатора, заголовка, описания, категории, изображения, цены.

Расширяется базовым абстрактным классом `Model<T>` по интерфейсу `IProductItem`.

```tsx
export interface IProductItem {
	id: string;
	title: string;
	description: string;
	category: string;
	image: string;
	price: number | null;
}
```

### Компоненты представления (View)

#### Класс `Card`

Этот класс является обобщённым компонентом, который может принимать параметры типа `T`. Он используется для создания карточек, отображающих информацию о продукте или элементе.

```tsx
interface ICard {
	title: string;
	description?: string | string[];
	image: string;
	category: string;
	price: number | null;
	text: string;
}
```

**Конструктор**

- принимает container типа `HTMLElement` и опциональный объект события `actions` типа ICardActions
  ```tsx
  interface ICardActions {
  	onClick: (event: MouseEvent) => void;
  }
  ```
- передает container в родительский конструктор
- если объект actions был передан, то вешает слушатель клика на `container` с вызовом объекта события `actions`

**Поля**

- `_title`: Элемент HTML, представляющий заголовок карточки.
- `_image`: Элемент изображения (HTMLImageElement), отображающий картинку в карточке.
- `_description`: Опциональный элемент HTML для отображения описания карточки.
- `_category`: Кнопка (HTMLButtonElement), отображающая категорию товара. -`_price`: Кнопка (HTMLButtonElement), отображающая цену товара.
- `_button`: Опциональная кнопка, которая может выполнять различные функции, например, добавление товара в корзину.
- `_categorySchemeCard`: Это объект, который сопоставляет названия категорий на русском языке с их кодами или идентификаторами на английском языке. Например:

`"софт-скил" соответствует "soft",
"другое" соответствует "other",
"дополнительное" соответствует "additional",
"кнопка" соответствует "button",
"хард-скил" соответствует "hard".`

**Методы**

`set title`(value: string):
Этот метод устанавливает текст заголовка (\_title) карточки.
Используется метод this.setText(this.\_title, value), который отвечает за установку текста элемента HTML.

`set image`(value: string):
Метод устанавливает изображение карточки (\_image).
Используется метод this.setImage(this.\_image, value, this.title), который отвечает за установку изображения и может использовать заголовок карточки в качестве альтернативного текста (alt) или для других целей.

`set price`(value: string):
Метод устанавливает цену товара.
Если значение value непустое, цена отображается как "Бесценно".
В противном случае цена отображается как комбинация числа и строки "синапсов", что подразумевает какую-то виртуальную валюту или метафорическую единицу.

`set category`(value: string):
Метод устанавливает категорию товара.
Сначала он устанавливает текст для элемента категории (\_category).
Затем присваивает элементу `_category` класс на основе категории, используя объект `_categorySchemeCard` для определения соответствующего класса. Если категория не найдена в объекте `_categorySchemeCard`, используется класс other.

#### Класс `CardPreview`

`CardPreview` отвечает за отображение данных карточки товара в виде превью. Он управляет отображением элементов интерфейса и данными, связанными с товаром.

```tsx
interface ICardPreview {
	text: string;
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер для отображения карточки.
- `actions`: `ICardActions` (необязательный) - объект, содержащий функции-обработчики событий.

```tsx
interface ICardActions {
	onClick: (event: MouseEvent) => void;
}
```

Передаёт `container` и `actions` в родительский конструктор.
Сохраняет необходимые элементы разметки в полях.
Если `actions` был передан, добавляет обработчик события click на кнопку `_button` и удаляет существующий обработчик с `container`.

**Поля**

- `_text` — содержит разметку описания превью
- `_button` — содержит разметку кнопки превью

**Методы**

- `set text` — установка содержимого описания превью

#### Класс `BasketItem`

Отвечает за отображение данных карточки товара в каталоге. Он управляет взаимодействием между элементами интерфейса и данными.

```tsx
interface BasketItem {
	title: string;
	price: number;
	index: number;
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер для карточки.
  actions: `ICardActions` (необязательный) - объект с функциями-обработчиками событий.
  ```tsx
  interface ICardActions {
  	onClick: (event: MouseEvent) => void;
  }
  ```
- Передаёт `container` в родительский конструктор.
- Сохраняет необходимые элементы разметки в полях.
- Если `actions` был передан, добавляет обработчик события click на кнопку `_button` и удаляет существующий обработчик с container.

**Поля**

- `_title` — содержит разметку заголовка.
- `_button` — содержит разметку кнопки для удаления.
- `_price` — одержит разметку цены.
- `_index` — содержит разметку порядкового номера.

**Методы**

- `set title` — содержит разметку порядкового номера.
- `set index` — задает содержимое порядкового номера.
- `set price` — задает содержимое цены.

#### Класс `Page`

Page отвечает за отображение основных компонентов страницы: каталог, корзину и счетчик товаров в корзине. Он также управляет функциональностью прокрутки страницы при открытии или закрытии модальных окон.

```tsx
interface IPage {
	catalog: HTMLElement[];
}
```

**Конструктор**

`container`: `HTMLElement` - основной контейнер страницы.
event: `IEvent` - объект, содержащий информацию о событиях.
Функциональность:

Передаёт `container` в родительский конструктор.
Сохраняет необходимые элементы разметки в полях.
Добавляет обработчик события click на кнопку корзины `_basket`, который регистрирует событие `basket:open`.

**Поля**

- `_counter` — содержит разметку счетчика товаров в корзине
- `_catalog` — содержит разметку каталога товаров
- `_wrapper` — содержит разметку обертки страницы
- `_basket` — содержит разметке кнопки корзины

**Методы**

- `set counter` — устанавливает значение в счетчике товаров корзины
- `set catalog` — устанавливает каталог
- `set locked` — устанавливает класс, препятствующий прокрутке страницы

#### Класс `Modal`

`Modal` отвечает за отображение модального окна. Он предоставляет функциональность для открытия и закрытия окна, а также наполнение его нужным контентом.

```tsx
interface IModalData {
	content: HTMLElement;
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер для модального окна.
- `event`: `IEvent` - объект, содержащий информацию о событиях.
- Передаёт `container` в родительский конструктор.
- Сохраняет необходимые элементы разметки в полях.
- Добавляет обработчики событий click на кнопку закрытия `_closeButton` и `container`, которые вызывают метод закрытия окна close.
- Добавляет обработчик события click на `content`, чтобы предотвратить закрытие окна при клике на его контенте.

**Поля**

- `_closeButton` — разметка кнопки закрытия модального окна
- `_content` — разметка контейнера для контента модального окна

**Методы**

- `set content` — установить контент модального окна
- `open` — открыть модальное окно
- `close` — закрыть модальное окно
- `render` — отрисовать данные контента и открыть модальное окно

#### Класс `Basket`

`Basket` отвечает за отображение корзины в модальном окне. Получает обновления через метод-посредник emit, чтобы обновить интерфейс, когда данные изменяются

```tsx
interface IBasketView {
	items: HTMLElement[];
	total: number;
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер для корзины.
- `event`: `IEvent` - объект, содержащий информацию о событиях.
- Передаёт `container` в родительский конструктор.
- Сохраняет необходимые элементы разметки в полях.
- Если есть `button`, добавляет обработчик события click, который регистрирует событие `order:open`.

**Поля**

- `_list` — содержит разметку обёртки списка товаров.
- `_total` — содержит разметку для отображения общей суммы товаров.
- `button` — содержит разметку кнопки для перехода к оформлению заказа.
- `items `— содержит список товаров в корзине.

**Методы**

- `set items` — устанавливает список товаров в разметку \_list. `_list`
- `set total` — устанавливает значение общей суммы товаров.

#### Класс `Order`

Order отвечает за отображение первого шага оформления заказа в модальном окне. Он управляет вводом данных заказа и их валидацией.

```tsx
export interface IOrderForm {
	payment: string;
	address: string;
	phone: string;
	email: string;
	total: string | number;
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер для формы заказа.
- `event`: `IEvent` - объект, содержащий информацию о событиях.
- Передаёт `container` и `event` в родительский конструктор.
- Сохраняет необходимые элементы разметки в полях.
- Добавляет обработчики событий click на кнопки выбора формы оплаты, которые вызывают метод payment для установки класса активности.

**Поля**

- `_buttons` — содержит разметку кнопок формы оплаты

**Методы**

- `set payment` — устанавливает класс активности для кнопки.
- `set address` — задает значение для поля адреса.

#### Класс `Contacts`

`Contacts` отвечает за отображение второго шага заказа в модальном окне. Он управляет вводом данных контактов и их валидацией.

**Конструктор**

- `container`: `HTMLElement` - контейнер для формы контактов.
- `event`: `IEvent` - объект, содержащий информацию о событиях.
- Передаёт `container` и `event` в родительский конструктор.

**Методы**

- `set phone` — задает значение для поля телефона.
- `set email` — задает значение для поля электронной почты.

#### Класс `Form<T>`

`Form` отвечает за основные способы работы с формой и её валидацию. Он предоставляет методы для обработки ввода данных и проверки их корректности.

Интерфейсы

```tsx
interface IFormState {
	valid: boolean;
	errors: string[];
}
```

**Конструктор**

- `container`: `HTMLElement` - контейнер формы.
- `event`: `IEvent` - объект, содержащий информацию о событиях.
- Передаёт `container` и `event` в родительский конструктор.
- Определяет абстрактные методы `validate` и `submit`, которые должны быть реализованы в дочерних классах.

**Поля**

- `_submit` — содержит разметку кнопки отправки формы
- `_errors` — содержит разметку вывода ошибок валидации

**Методы**

- `onInputChange` — регистрирует событие изменения конкретного поля формы.
- `set valid` — метод установки валидности
- `set errors` — метод установки ошибки

#### Класс `Success`

`Success` отвечает за отображение успешного оформления заказа в модальном окне. Он служит контентом для модального окна, отображая информацию о завершённой транзакции.

```tsx
interface ISuccess {
	total: number;
}
```

**Конструктор**

- принимает `container` типа `HTMLElement` и опциональный объект события `actions` типа `ISuccessActions`
  ```tsx
  interface ISuccessActions {
  	onClick: () => void;
  }
  ```
- Передаёт `container` в родительский конструктор.
- Сохраняет необходимые элементы разметки в полях.
- Если объект `actions` был передан, добавляет обработчик клика на кнопку `_close`, который вызывает соответствующее событие.

**Поля**

- `_total` — разметка общей суммы товаров в заказе
- `_close` — разметка кнопки закрытия окна

**Методы**

- `set total` — установка значения общей суммы
